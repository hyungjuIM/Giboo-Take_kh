<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="myPage-mapper">

	<!-- 기부(donation) 목록용 resultMap -->
	<resultMap type="myActiveDonationList"
		id="myActiveDonationList_rm">
		<id property="myactiveDonationNo" column="MYACTIVE_DONATION_NO" />
		<result property="myactiveDate" column="MYACTIVE_DATE" />
		<result property="volunteerCompleteStatus"
			column="VOLUNTEER_COMPLETE_STATUS" />
		<result property="donationMoney" column="DONATION_MONEY" />
		<result property="donationNo" column="DONATION_NO" />
		<result property="memberNo" column="MEMBER_NO" />

		<result property="enrollDate" column="ENROLL_DATE" />
		<result property="donationTitle" column="DONATION_TITLE" />
		<result property="donationAmount" column="DONATION_AMOUNT" />
	</resultMap>

	<!-- 봉사(VOLUNTEER) 목록용 resultMap -->
	<resultMap type="myActiveVolunteerList"
		id="myActiveVolunteerList_rm">
		<id property="myactiveVolunteerNo" column="MYACTIVE_VOLUNTEER_NO" />
		<result property="myactiveDate" column="MYACTIVE_DATE" />
		<result property="volunteerCompleteStatus"
			column="VOLUNTEER_COMPLETE_STATUS" />
		<result property="volunteerNo" column="VOLUNTEER_NO" />
		<result property="memberNo" column="MEMBER_NO" />

		<result property="volunteerTitle" column="VOLUNTEER_TITLE" />
		<result property="startProgressDate"
			column="START_PROGRESS_DATE" />
		<result property="volunteerAddr" column="VOLUNTEER_ADDR" />
		<result property="enrollDate" column="ENROLL_DATE" />
	</resultMap>

	<!-- 이벤트(EVENT) 목록 조회 resultMap -->
	<resultMap type="myActiveEventList" id="myActiveEventList_rm">
		<id property="myactiveEventNo" column="MYACTIVE_EVENT_NO" />
		<result property="myactiveDate" column="MYACTIVE_DATE" />
		<result property="volunteerCompleteStatus"
			column="VOLUNTEER_COMPLETE_STATUS" />
		<result property="volunteerNo" column="VOLUNTEER_NO" />
		<result property="managerNo" column="MANAGER_NO" />

		<result property="eventTitle" column="EVENT_TITLE" />
		<result property="eventNo" column="EVENT_NO" />
		<result property="enrollDate" column="ENROLL_DATE" />
		<result property="endRecruitDate" column="END_RECRUIT_DATE" />
	</resultMap>

	<!-- 댓글 목록 조회 resultMap -->
	<resultMap type="myReview" id="myReview_rm">
		<id property="reviewNo" column="REVIEW_NO" />
		<result property="donationTitle" column="DONATION_TITLE" />
		<result property="volunteerTitle" column="VOLUNTEER_TITLE" />
		<result property="reviewContent" column="REVIEW_CONTENT" />
		<result property="enrollDate" column="ENROLL_DATE" />


		<result property="memberNo" column="MEMBER_NO" />
		<result property="donationNo" column="DONATION_NO" />
		<result property="volunteerNo" column="VOLUNTEER_NO" />
		<result property="secessionFl" column="SECESSION_FL" />

	</resultMap>

	<!--기부 게시판 전체 게시글 수 조회 -->
	<select id="getListCount1" resultType="_int">
		SELECT COUNT(*) FROM
		MYACTIVE_DONATION WHERE MEMBER_NO = #{memberNo}
	</select>

	<!--봉사 게시판 전체 게시글 수 조회 -->
	<select id="getListCount2" resultType="_int">
		SELECT COUNT(*) FROM
		MYACTIVE_VOLUNTEER WHERE MEMBER_NO = 7
	</select>

	<!--이벤트 게시판 전체 게시글 수 조회 -->
	<select id="getListCount3" resultType="_int">
		SELECT COUNT(*) FROM
		MYACTIVE_EVENT WHERE MEMBER_NO = 7
	</select>

	<!-- 댓글 게시판 전체 게시글 수 조회 -->
	<select id="getListCount4" resultType="_int">
		SELECT COUNT(*) FROM
		REVIEW
		WHERE MEMBER_NO = 7
	</select>

	<!-- 기부 목록 조회 -->
	<select id="selectMyactiveDonationList"
		resultMap="myActiveDonationList_rm">
		
		SELECT DISTINCT M.MYACTIVE_DONATION_NO, M.MYACTIVE_DATE, M.DONATION_MONEY,
       D.DONATION_TITLE, D.DONATION_AMOUNT, D.DONATION_NO
FROM MYACTIVE_DONATION M
JOIN DONATION D ON M.DONATION_NO = D.DONATION_NO
WHERE M.MEMBER_NO = #{memberNo}
ORDER BY M.MYACTIVE_DONATION_NO DESC
		
		
		
	</select>

	<!--  	SELECT ROW_NUMBER() OVER (ORDER BY M.MYACTIVE_DONATION_NO DESC) AS ROWNUM_VAL, 
		M.MYACTIVE_DONATION_NO, M.MYACTIVE_DATE,
		M.DONATION_MONEY, D.DONATION_TITLE,
		D.DONATION_AMOUNT, D.DONATION_NO
		FROM DONATION D
		JOIN MYACTIVE_DONATION M ON D.MEMBER_NO = M.MEMBER_NO
		AND D.DONATION_NO =
		M.DONATION_NO
		WHERE D.MEMBER_NO = 7
		ORDER BY
		MYACTIVE_DONATION_NO DESC   -->

	<!-- 봉사 목록 조회 -->
	<select id="selectMyActiveVolunteerList"
		resultMap="myActiveVolunteerList_rm">
		
		SELECT ROW_NUMBER() OVER (ORDER BY M.MYACTIVE_VOLUNTEER_NO DESC) AS ROWNUM_VAL, 
M.MYACTIVE_VOLUNTEER_NO, M.MYACTIVE_DATE, V.VOLUNTEER_TITLE, V.ENROLL_DATE , V.VOLUNTEER_ADDR,
		V.VOLUNTEER_NO FROM
		VOLUNTEER V
		JOIN MYACTIVE_VOLUNTEER M ON V.MEMBER_NO = M.MEMBER_NO AND
		V.VOLUNTEER_NO
		= M.VOLUNTEER_NO
		WHERE V.MEMBER_NO = 7
		ORDER BY
		MYACTIVE_VOLUNTEER_NO DESC  
		

	</select>

		<!-- 
		SELECT DISTINCT M.MYACTIVE_VOLUNTEER_NO, M.MYACTIVE_DATE, V.VOLUNTEER_TITLE, V.ENROLL_DATE , V.VOLUNTEER_ADDR,
		V.VOLUNTEER_NO FROM
		VOLUNTEER V
		JOIN MYACTIVE_VOLUNTEER M ON V.MEMBER_NO = M.MEMBER_NO AND
		V.VOLUNTEER_NO
		= M.VOLUNTEER_NO
		WHERE V.MEMBER_NO = 7
		ORDER BY
		MYACTIVE_VOLUNTEER_NO DESC		
		 -->



	<!-- 이벤트 목록 조회 -->
	<select id="selectMyActiveEventList"
		resultMap="myActiveEventList_rm">
		SELECT ROW_NUMBER() OVER (ORDER BY ME.MYACTIVE_EVENT_NO DESC) AS ROWNUM_VAL,
       ME.MYACTIVE_EVENT_NO, ME.MYACTIVE_DATE, E.EVENT_TITLE
FROM MYACTIVE_EVENT ME
JOIN EVENT E ON E.EVENT_NO = ME.EVENT_NO
WHERE ME.MEMBER_NO = '7'
ORDER BY ME.MYACTIVE_EVENT_NO DESC
	</select>

	<!-- SELECT ME.MYACTIVE_EVENT_NO, ME.MYACTIVE_DATE, ME.EVENT_NO, E.EVENT_TITLE 
		FROM MYACTIVE_EVENT ME JOIN EVENT E ON E.EVENT_NO = ME.EVENT_NO WHERE ME.MEMBER_NO 
		= '7' ORDER BY ME.MYACTIVE_EVENT_NO DESC -->

	<!-- -->

	<!-- ==================================================== -->

	<!-- 리뷰 목록 조회 -->
	<select id="selectMyReview" resultMap="myReview_rm">
		SELECT ROW_NUMBER() OVER (ORDER BY R.REVIEW_NO DESC) AS ROWNUM_VAL, 
		R.REVIEW_NO,
		CASE
		WHEN R.DONATION_NO IS NOT NULL THEN D.DONATION_TITLE
		WHEN
		R.VOLUNTEER_NO IS NOT NULL THEN V.VOLUNTEER_TITLE
		ELSE '제목 없음'
		END AS
		TITLE,
		R.REVIEW_CONTENT,
		TO_CHAR(R.ENROLL_DATE, 'DD.MM.RR') AS
		ENROLL_DATE
		FROM
		REVIEW R
		LEFT JOIN
		DONATION D ON D.DONATION_NO =
		R.DONATION_NO
		LEFT JOIN
		VOLUNTEER V ON V.VOLUNTEER_NO = R.VOLUNTEER_NO
		WHERE
		R.MEMBER_NO = '7'
		ORDER BY
		R.REVIEW_NO DESC

	</select>
</mapper>
