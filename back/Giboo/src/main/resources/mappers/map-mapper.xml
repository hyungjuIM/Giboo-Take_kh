<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mapMapper">

	<!-- 지도 목록 조회 -->
	<resultMap type="mapList" id="map_rm">
		<id property="mapNo" column="MAP_NO"/>
		<result property="volunteerAttachement" column="VAGENCY_NAME"/>
		<result property="parentCategoryName" column="VAGENCY_NAME"/>
		<result property="agencyName" column="VAGENCY_NAME"/>
		<result property="agencyName" column="VAGENCY_NAME"/>
		<result property="agencyName" column="VAGENCY_NAME"/>
	</resultMap>
	
	<!-- 전체 게시글 수 조회 -->
	<select id="getMapListCount">
		SELECT COUNT(*) FROM MAP
	</select>

	<!-- 목록 조회 -->
	<select id="">
		SELECT
	    V.VOLUNTEER_ATTACHMENT,
	    PC.PARENT_CATEGORY_NAME,
	    A.AGENCY_NAME,
		V.VOLUNTEER_ADDR ,
	    (
	        SELECT COUNT(*) FROM REPLY R WHERE R.VOLUNTEER_NO = V.VOLUNTEER_NO
	    ) AS REPLYCOUNT,
	    (
	        SELECT COUNT(DISTINCT MV.MEMBER_NO) FROM MYACTIVE_VOLUNTEER MV WHERE MV.VOLUNTEER_NO = V.VOLUNTEER_NO
	    ) AS VOLUNTEERCOUNT
	FROM
	    VOLUNTEER V
	    JOIN PARENT_CATEGORY PC ON PC.CATEGORY_NO = 2
	    JOIN AGENCY A ON A.MEMBER_NO = V.MEMBER_NO
	</select>
	
	<!-- 검색 게시글 목록 전체 개수 조회 -->
	<select id="searchListCount">

		SELECT COUNT(*) FROM MAP
		
			<!-- 검색어가 있을 경우 -->
			<if test='query != null and query != ""'>
				AND
				<choose>
					<when test='key == "t"'> 
						BOARD_TITLE LIKE '%${query}%'
					</when>
					
					<when test='key == "c"'>
						BOARD_CONTENT LIKE '%' || #{query} || '%'
					</when>
					
					<when test='key == "tc"'>
						( BOARD_TITLE LIKE '%${query}%'
						OR
						BOARD_CONTENT LIKE '%${query}%' )
					</when>
					
					<when test='key == "w"'>
						MEMBER_NICK LIKE '%${query}%'
					</when>
				</choose>			
			</if>	
	</select>
</mapper>
